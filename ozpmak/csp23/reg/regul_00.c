//----------------------------------------------------------------------------
// Общие функции регуляторов

#include "..\prg\_libpath.inc"
#include "..\prg\run_prgv.h"
#include "..\prg\run_prgr.h"

#include "regul_e.h"

_f  far A3SPAT___S = 0;            // предыдущ состоян канала "сброс в атмосф"
_f  far A3SPAK___S = 0;            // предыдущ состоян канала "сброс в акумул"
_f  far A4SPAT___S = 0;            // 
_f  far A4SPAK___S = 0;            // 

//----------------------------------------------------------------------------
vd  far Regul_up(vd){

    // УСТАНОВКА И ПРОВЕРКА ПАРАМЕТРОВ И ЗАДАНИЙ ДЛЯ РЕГУЛЯТОРА

    // выбор режимов работы для цикла
    if(A3NAKPP_YM==SWITCH){ A3NAKPP_YV=(A3NAKPP_YV>OFF) then_ OFF else_ ON; }
    if(A3RAZVK_YM==SWITCH){ A3RAZVK_YV=(A3RAZVK_YV>OFF) then_ OFF else_ ON; }
    if(A3PPP___YM==SWITCH){ A3PPP___YV=(A3PPP___YV>OFF) then_ OFF else_ ON; }
    if(A3PVID__YM==SWITCH){ A3PVID__YV=(A3PVID__YV>OFF) then_ OFF else_ ON; }
    if(A3SP____YM==SWITCH){ A3SP____YV=(A3SP____YV>OFF) then_ OFF else_ ON; }
    A3NAKPP_YM=OFF; A3RAZVK_YM=OFF; A3PPP___YM=OFF; 
    A3PVID__YM=OFF; A3SP____YM=OFF;
    if(A4NAKPP_YM==SWITCH){ A4NAKPP_YV=(A4NAKPP_YV>OFF) then_ OFF else_ ON; }
    if(A4RAZVK_YM==SWITCH){ A4RAZVK_YV=(A4RAZVK_YV>OFF) then_ OFF else_ ON; }
    if(A4PPP___YM==SWITCH){ A4PPP___YV=(A4PPP___YV>OFF) then_ OFF else_ ON; }
    if(A4PVID__YM==SWITCH){ A4PVID__YV=(A4PVID__YV>OFF) then_ OFF else_ ON; }
    if(A4SP____YM==SWITCH){ A4SP____YV=(A4SP____YV>OFF) then_ OFF else_ ON; }
    A4NAKPP_YM=OFF; A4RAZVK_YM=OFF; A4PPP___YM=OFF; 
    A4PVID__YM=OFF; A4SP____YM=OFF;


    // проверка ввода номера автоклава для перепуска
    if(A3NAKPP__R==3 or  A3NAKPP__R> 6){ A3NAKPP__R=0; }
    if(A4NAKPP__R==4 or  A4NAKPP__R> 6){ A4NAKPP__R=0; }

    // выбор назначения сброса пара
    if(A3SPAT___R> 0 and A3SPAT___S==0){ A3SPAK___R=0; }
    if(A3SPAK___R> 0 and A3SPAK___S==0){ A3SPAT___R=0; }
    if(A3SPAT___R==0 and A3SPAK___R==0){ A3SPAT___R=1; }
    A3SPAT___S=A3SPAT___R;
    A3SPAK___S=A3SPAK___R;
    if(A4SPAT___R> 0 and A4SPAT___S==0){ A4SPAK___R=0; }
    if(A4SPAK___R> 0 and A4SPAK___S==0){ A4SPAT___R=0; }
    if(A4SPAT___R==0 and A4SPAK___R==0){ A4SPAT___R=1; }
    A4SPAT___S=A4SPAT___R;
    A4SPAK___S=A4SPAK___R;

    // контроль заполнения таблицы режимов 
    //----------------------------------------------
    // набор перепускным паром по Т 
    if(A31NTPP01R>A31NTPP02R) A31NTPP02R=A31NTPP01R;
    if(A31NTPP02R>A31NTPP03R) A31NTPP03R=A31NTPP02R;
    if(A31NTPP03R>A31NTPP04R) A31NTPP04R=A31NTPP03R;
    if(A31NTPP04R>A31NTPP05R) A31NTPP05R=A31NTPP04R;
    // набор острым  паром по Т
    if(A31NTOP01R>A31NTOP02R) A31NTOP02R=A31NTOP01R;
    if(A31NTOP02R>A31NTOP03R) A31NTOP03R=A31NTOP02R;
    if(A31NTOP03R>A31NTOP04R) A31NTOP04R=A31NTOP03R;
    if(A31NTOP04R>A31NTOP05R) A31NTOP05R=A31NTOP04R;
    // набор перепускным паром по P
    if(A31NPPP01R>A31NPPP02R) A31NPPP02R=A31NPPP01R;
    if(A31NPPP02R>A31NPPP03R) A31NPPP03R=A31NPPP02R;
    if(A31NPPP03R>A31NPPP04R) A31NPPP04R=A31NPPP03R;
    if(A31NPPP04R>A31NPPP05R) A31NPPP05R=A31NPPP04R;
    if(A31NPPP05R>A31NPPP06R) A31NPPP06R=A31NPPP05R;
    if(A31NPPP06R>A31NPPP07R) A31NPPP07R=A31NPPP06R;
    if(A31NPPP07R>A31NPPP08R) A31NPPP08R=A31NPPP07R;
    if(A31NPPP08R>A31NPPP09R) A31NPPP09R=A31NPPP08R;
    if(A31NPPP09R>A31NPPP10R) A31NPPP10R=A31NPPP09R;
    // набор острым  паром по P
    if(A31NPOP01R>A31NPOP02R) A31NPOP02R=A31NPOP01R;
    if(A31NPOP02R>A31NPOP03R) A31NPOP03R=A31NPOP02R;
    if(A31NPOP03R>A31NPOP04R) A31NPOP04R=A31NPOP03R;
    if(A31NPOP04R>A31NPOP05R) A31NPOP05R=A31NPOP04R;
    if(A31NPOP05R>A31NPOP06R) A31NPOP06R=A31NPOP05R;
    if(A31NPOP06R>A31NPOP07R) A31NPOP07R=A31NPOP06R;
    if(A31NPOP07R>A31NPOP08R) A31NPOP08R=A31NPOP07R;
    if(A31NPOP08R>A31NPOP09R) A31NPOP09R=A31NPOP08R;
    if(A31NPOP09R>A31NPOP10R) A31NPOP10R=A31NPOP09R;
    // сброс давления в атмосферу
    if(A31SPAP04R>A31SPAP05R) A31SPAP04R=A31SPAP05R;
    if(A31SPAP03R>A31SPAP04R) A31SPAP03R=A31SPAP04R;
    if(A31SPAP02R>A31SPAP03R) A31SPAP02R=A31SPAP03R;
    if(A31SPAP01R>A31SPAP02R) A31SPAP01R=A31SPAP02R;
    // сброс давления в акумулятор
    if(A31SPKP04R>A31SPKP05R) A31SPKP04R=A31SPKP05R;
    if(A31SPKP03R>A31SPKP04R) A31SPKP03R=A31SPKP04R;
    if(A31SPKP02R>A31SPKP03R) A31SPKP02R=A31SPKP03R;
    if(A31SPKP01R>A31SPKP02R) A31SPKP01R=A31SPKP02R;

    //----------------------------------------------
    // набор перепускным паром по Т 
    if(A41NTPP01R>A41NTPP02R) A41NTPP02R=A41NTPP01R;
    if(A41NTPP02R>A41NTPP03R) A41NTPP03R=A41NTPP02R;
    if(A41NTPP03R>A41NTPP04R) A41NTPP04R=A41NTPP03R;
    if(A41NTPP04R>A41NTPP05R) A41NTPP05R=A41NTPP04R;
    // набор острым  паром по Т
    if(A41NTOP01R>A41NTOP02R) A41NTOP02R=A41NTOP01R;
    if(A41NTOP02R>A41NTOP03R) A41NTOP03R=A41NTOP02R;
    if(A41NTOP03R>A41NTOP04R) A41NTOP04R=A41NTOP03R;
    if(A41NTOP04R>A41NTOP05R) A41NTOP05R=A41NTOP04R;
    // набор перепускным паром по P
    if(A41NPPP01R>A41NPPP02R) A41NPPP02R=A41NPPP01R;
    if(A41NPPP02R>A41NPPP03R) A41NPPP03R=A41NPPP02R;
    if(A41NPPP03R>A41NPPP04R) A41NPPP04R=A41NPPP03R;
    if(A41NPPP04R>A41NPPP05R) A41NPPP05R=A41NPPP04R;
    if(A41NPPP05R>A41NPPP06R) A41NPPP06R=A41NPPP05R;
    if(A41NPPP06R>A41NPPP07R) A41NPPP07R=A41NPPP06R;
    if(A41NPPP07R>A41NPPP08R) A41NPPP08R=A41NPPP07R;
    if(A41NPPP08R>A41NPPP09R) A41NPPP09R=A41NPPP08R;
    if(A41NPPP09R>A41NPPP10R) A41NPPP10R=A41NPPP09R;
    // набор острым  паром по P
    if(A41NPOP01R>A41NPOP02R) A41NPOP02R=A41NPOP01R;
    if(A41NPOP02R>A41NPOP03R) A41NPOP03R=A41NPOP02R;
    if(A41NPOP03R>A41NPOP04R) A41NPOP04R=A41NPOP03R;
    if(A41NPOP04R>A41NPOP05R) A41NPOP05R=A41NPOP04R;
    if(A41NPOP05R>A41NPOP06R) A41NPOP06R=A41NPOP05R;
    if(A41NPOP06R>A41NPOP07R) A41NPOP07R=A41NPOP06R;
    if(A41NPOP07R>A41NPOP08R) A41NPOP08R=A41NPOP07R;
    if(A41NPOP08R>A41NPOP09R) A41NPOP09R=A41NPOP08R;
    if(A41NPOP09R>A41NPOP10R) A41NPOP10R=A41NPOP09R;
    // сброс давления в атмосферу
    if(A41SPAP04R>A41SPAP05R) A41SPAP04R=A41SPAP05R;
    if(A41SPAP03R>A41SPAP04R) A41SPAP03R=A41SPAP04R;
    if(A41SPAP02R>A41SPAP03R) A41SPAP02R=A41SPAP03R;
    if(A41SPAP01R>A41SPAP02R) A41SPAP01R=A41SPAP02R;
    // сброс давления в акумулятор
    if(A41SPKP04R>A41SPKP05R) A41SPKP04R=A41SPKP05R;
    if(A41SPKP03R>A41SPKP04R) A41SPKP03R=A41SPKP04R;
    if(A41SPKP02R>A41SPKP03R) A41SPKP02R=A41SPKP03R;
    if(A41SPKP01R>A41SPKP02R) A41SPKP01R=A41SPKP02R;
    //----------------------------------------------

    return;
}
//----------------------------------------------------------------------------
